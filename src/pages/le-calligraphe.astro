---
import Base from "../layouts/Layout.astro";
import fs from 'fs';
import yaml from 'js-yaml';

// Charger le YAML
const ateliers = yaml.load(fs.readFileSync('./src/content/ateliers.yaml', 'utf8'));

// Trier les années décroissantes
const sortedYears = Object.keys(ateliers).sort((a, b) => Number(b) - Number(a));

// Helper pour afficher les dates en français "5 février 2011"
function formatDateFR(from) {
  if (!from) return "";
  const months = [
    "janvier", "février", "mars", "avril", "mai", "juin",
    "juillet", "août", "septembre", "octobre", "novembre", "décembre"
  ];
  const date = new Date(from.split(" ")[0]); // ignore heure si présente
  return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
}
---

<Base title="Christophe Desmur — Calligraphe et traducteur littéraire du chinois">
  <main class="mx-auto max-w-[735px] mt-14">
    <h1 class="text-4xl lg:text-5xl font-bold lg:tracking-tight mt-1 lg:leading-tight">
      Christophe Desmur, calligraphe et traducteur littéraire du chinois
    </h1>
    <p class="text-lg mt-4 text-gray-600">
      Je suis calligraphe depuis plus de trente ans et m'intéresse particulièrement aux langues et civilisations asiatiques.
    </p>

    <h2 class="text-4xl lg:text-3xl font-bold text-gray-600 mt-10">Ateliers & interventions</h2>

    <!-- Navigation années -->
    <nav class="flex flex-wrap gap-4 mb-6">
      {sortedYears.map((annee, idx) => (
        <button
          class={`year-btn px-4 py-2 rounded font-semibold transition-colors duration-300
            ${idx === 0 ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`}
          data-year={annee}
        >
          {annee}
        </button>
      ))}
    </nav>

    <!-- Sections par année -->
    {sortedYears.map((annee, idx) => (
      <section
        key={annee}
        class={`year-section ${idx === 0 ? '' : 'hidden'} mt-6`}
        data-year={annee}
      >
        <ul class="mt-4 space-y-2">
          {ateliers[annee].map((event) => (
            <li key={event.from + event.titre} class="border-b pb-2">
              <strong>{formatDateFR(event.from)}</strong>
              {" — "}
              {event.href ? (
                <a href={event.href} class="text-indigo-600 hover:underline">
                  {event.titre}
                </a>
              ) : (
                event.titre
              )}
              <br />
              <em>{event.lieu}</em>
              {event.details && (
                <>
                  <br />
                  {event.details}
                </>
              )}
            </li>
          ))}
        </ul>
      </section>
    ))}
  </main>

  <script>
    const yearButtons = document.querySelectorAll(".year-btn");

    yearButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const year = btn.dataset.year;

        // Afficher la section de l'année choisie
        document.querySelectorAll(".year-section").forEach(sec => {
          sec.classList.toggle("hidden", sec.dataset.year !== year);
        });

        // Changer le style du bouton actif
        yearButtons.forEach(b => {
          b.classList.remove("bg-indigo-600", "text-white");
          b.classList.add("bg-gray-200", "text-gray-800");
        });
        btn.classList.add("bg-indigo-600", "text-white");
        btn.classList.remove("bg-gray-200", "text-gray-800");

        // Scroll fluide
        const section = document.querySelector(`.year-section[data-year='${year}']`);
        if (section) {
          section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // Mettre en surbrillance le premier bouton
    if (yearButtons.length) {
      yearButtons[0].classList.add("bg-indigo-600", "text-white");
      yearButtons[0].classList.remove("bg-gray-200", "text-gray-800");
    }
  </script>
</Base>
