---
import Base from "../layouts/Layout.astro";
import fs from 'fs';
import yaml from 'js-yaml';

// Load YAML
const ateliers = yaml.load(fs.readFileSync('./src/content/ateliers.yaml', 'utf8'));

// Flatten all events and keep only those with href="/colleges"
const collegesEvents = Object.values(ateliers)
  .flat()
  .filter(event => event.href === "/colleges")
  .sort((a, b) => {
    // Parse DD/MM/YYYY
    const [dayA, monthA, yearA] = a.date.split("/").map(Number);
    const [dayB, monthB, yearB] = b.date.split("/").map(Number);

    // Create Date objects
    const dateA = new Date(yearA, monthA - 1, dayA);
    const dateB = new Date(yearB, monthB - 1, dayB);

    // Sort descending: most recent first
    return dateB - dateA;
  });
---

<Base title="Ateliers pour collèges">
  <main class="mx-auto max-w-[735px] mt-14">
<h1 class="text-3xl font-bold mb-6">
  Ateliers de calligraphie pour collèges : horaires, tarifs et organisation
</h1>

<h2 class="text-2xl font-semibold mb-4">
  Mes formats d'atelier pour les collèges
</h2>

<div class="overflow-x-auto">
  <table class="min-w-full border border-gray-300 divide-y divide-gray-200">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-4 py-2 text-left font-medium text-gray-700">Horaires</th>
        <th class="px-4 py-2 text-left font-medium text-gray-700">Temps scolaire</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <tr>
        <td class="px-4 py-2">Durée</td>
        <td class="px-4 py-2">2 à 3 heures</td>
      </tr>
      <tr class="bg-gray-50">
        <td class="px-4 py-2">Nombre de participants</td>
        <td class="px-4 py-2">25 élèves maximum</td>
      </tr>
      <tr>
        <td class="px-4 py-2">Tarifs</td>
        <td class="px-4 py-2">60 euros HT par heure</td>
      </tr>
    </tbody>
  </table>
</div>


    <p class="text-lg mt-4 text-gray-600">
      Liste de tous les ateliers destinés aux collèges, du plus récent au plus ancien.
    </p>

    <ul class="mt-6 space-y-4">
      {collegesEvents.map(event => (
        <li key={event.date + event.titre} class="border-b pb-2">
          <strong>{event.date}</strong> —{" "}
          <a href={event.href} class="text-indigo-600 hover:underline">
            {event.titre}
          </a>
          <br />
          <em>{event.lieu}</em>
          <br />
          {event.details}
        </li>
      ))}
    </ul>
  </main>
</Base>
